<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Receipt ‚Äî Tazamall</title>
  <link rel="stylesheet" href="style.css">
  <link href="https://fonts.googleapis.com/css2?family=Great+Vibes&display=swap" rel="stylesheet">
  <style>
    .signature { font-family: 'Great Vibes', cursive; font-size: 42px; color: #222; margin: 0; }
  </style>
</head>
<body>
<header>
  <div class="taz"><a href="index.html" style="text-decoration:none;color:inherit">Tazamall</a></div>
</header>

<div class="container" style="max-width:900px">
  <div style="background:var(--card);padding:18px;border-radius:12px;box-shadow:var(--shadow);margin-top:18px" id="receipt"></div>
</div>

<script src="products.js"></script>
<script src="main.js"></script>
<script>
const params = new URLSearchParams(location.search);
const id = params.get("order");
const orders = JSON.parse(localStorage.getItem(ORDERS_KEY)) || [];
const o = orders.find(x=>x.id===id);
const out = document.getElementById("receipt");

if(!o) {
  out.innerHTML = "<h3 style='color:#c33'>Order not found</h3>";
} else {
  // Format date nicely
  const orderDate = new Date(o.createdAt);
  const dateStr = orderDate.toLocaleString('en-KE', { 
    year: 'numeric', 
    month: 'long', 
    day: 'numeric',
    hour: '2-digit',
    minute: '2-digit'
  });
  
  out.innerHTML = `
    <div style="text-align:center;margin-bottom:24px;border-bottom:2px solid #ddd;padding-bottom:16px">
      <h1 style="margin:0;font-size:28px">TAZAMALL</h1>
      <p style="margin:4px 0;color:#666">Receipt</p>
    </div>
    
    <div style="display:flex;justify-content:space-between;margin-bottom:16px">
      <div>
        <div style="margin:4px 0"><span style="color:#666">Order ID:</span> <strong>${o.id}</strong></div>
        <div style="margin:4px 0"><span style="color:#666">Customer Name:</span> <strong>${o.name}</strong></div>
        <div style="margin:4px 0"><span style="color:#666">Phone:</span> <strong>${o.phone}</strong></div>
        <div style="margin:4px 0"><span style="color:#666">Delivery Address:</span> <strong>${o.address}</strong></div>
      </div>
      <div style="text-align:right">
        <div style="margin:4px 0"><span style="color:#666">Date & Time:</span></div>
        <div style="font-weight:800">${dateStr}</div>
        <div style="margin-top:12px;padding:10px;background:#f0f9f2;border-radius:6px;color:#2d5016">
          <strong>Status: ${o.status}</strong>
        </div>
      </div>
    </div>
    
    <div style="margin:16px 0;border-top:1px dashed #ddd;border-bottom:1px dashed #ddd;padding:12px 0">
      <div style="display:flex;justify-content:space-between;font-weight:600;margin-bottom:8px;color:#333">
        <div>Item</div>
        <div>Qty</div>
        <div style="text-align:right">Amount</div>
      </div>
      ${o.items.map(it=>`
        <div style="display:flex;justify-content:space-between;padding:8px 0;border-bottom:1px solid #eee">
          <div style="flex:1">${it.name}</div>
          <div style="width:50px;text-align:center">${it.qty}</div>
          <div style="width:120px;text-align:right;font-weight:600">KES ${it.subtotal.toLocaleString()}</div>
        </div>
      `).join("")}
    </div>
    
    <div style="display:flex;justify-content:space-between;margin:16px 0;padding:12px;background:#f5f5f5;border-radius:6px;font-size:18px">
      <strong>TOTAL</strong>
      <strong style="font-size:24px;color:#2d5016">KES ${Number(o.total).toLocaleString()}</strong>
    </div>
    
    <div style="text-align:center;color:#666;margin-top:16px;font-size:12px">
      <p>Thank you for shopping with Tazamall!</p>
      <p>Track your order or print this receipt for your records.</p>
    </div>
    
    <div style="margin-top:32px;display:flex;justify-content:center;padding-top:20px;border-top:2px solid #ddd">
      <div style="text-align:center;width:300px">
        <p class="signature">Whicklian</p>
        <div style="height:50px;border-top:2px solid #333;margin-top:8px"></div>
      </div>
    </div>
    
    <div style="margin-top:24px;display:flex;gap:8px;justify-content:center">
      <button onclick="window.print()" class="btn" style="background:#2d5016;color:white">üñ®Ô∏è Print Receipt</button>
      <button onclick="location.href='tracking.html?order=${o.id}'" class="btn ghost">üìç Track Order</button>
      <button onclick="location.href='index.html'" class="btn ghost">üè† Back to Shop</button>
    </div>
  `;
}
</script>
</body>
</html>